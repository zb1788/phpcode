<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>数学后台</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="__PUBLIC__/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="__PUBLIC__/dist/css/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="__PUBLIC__/dist/css/Ionicons/css/ionicons.min.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="__PUBLIC__/dist/js/iCheck/all.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="__PUBLIC__/dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="__PUBLIC__/dist/css/skins/_all-skins.min.css">
  <!-- Pace style -->
  <link rel="stylesheet" href="__PUBLIC__/dist/js/pace/pace.min.css">
  <link rel="stylesheet" href="__PUBLIC__/dist/js/webupload/webuploader.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->


</head>
<!-- ADD THE CLASS fixed TO GET A FIXED HEADER AND SIDEBAR LAYOUT -->
<!-- the fixed layout is not compatible with sidebar-mini -->

<body>
  <!-- Site wrapper -->
  <div class="wrapper">
    <div>
      <section class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title"></h3>
              </div>
              <!-- /.box-header -->
              <!-- form start -->
              <form role="form" id="form" class="form-horizontal">
                <div class="box-body">
                  <div class="form-group">
                    <div class="col-md-1">
                      <label>
                        <a id="daochu">
                          <i class="glyphicon glyphicon-download-alt"></i>下载模版
                        </a>
                      </label>
                    </div>
                    <div class="col-md-11" id="questionType">

                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-md-12">
                      <label>
                        <div class="uploader-container">
                          <div id="filePicker">导入excel</div>
                        </div>
                      </label>
                    </div>
                  </div>
                  <div class="form-group" id="content">
                    <div class="col-md-12">
                      <label for="time">&nbsp;&nbsp;&nbsp;题干（
                        <font style="color:#d33724">题干中图片和文字是上下排版的，图片要选择居中</font>）</label>
                      <script id="editor" type="text/plain" style="width:100%;height:100px;"></script>
                    </div>
                  </div>
                  <div class="form-group" id="answerflag">
                    <div class="col-md-1">
                      <label for="r3">类型</label>
                    </div>
                    <div class="col-md-11">
                      <label>
                        <input type="radio" name="r4" class="flat-red" value="1" checked/>单选
                      </label>
                      <label>
                        <input type="radio" name="r4" class="flat-red" value="2" />多选
                      </label>
                    </div>
                  </div>
                  <div class="form-group" id="content_pic_id" style="display:none;">
                    <div class="col-md-3">
                      <label>
                        图片上传 (
                        <font style="color:#d33724 !important;">只能上传一张图片</font>)
                      </label>
                      <input type="file" name="file" onchange="checkImage();">
                    </div>
                    <div class="col-md-9">
                      <img src="" alt="" class="img-rounded" width="110" height="70" id="contentPic">
                    </div>
                  </div>
                  <div class="form-group" id="choice_id">
                    <div class="col-md-1">
                      <label for="questionName">答案选项</label>
                    </div>
                    <div class="col-md-11">
                      <label>
                        <input type="radio" name="r5" class="flat-red" value="1" checked/>文字
                      </label>
                      <label>
                        <input type="radio" name="r5" class="flat-red" value="2" />图片（
                        <font style="color:#d33724">建议内容图片尺寸300*225,大小不超过10K</font>）
                      </label>
                    </div>
                    <!-- <div class="col-md-9">
                      <button type="button" class="btn btn-xs " onclick="addChoice();">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                      </button>
                    </div> -->
                  </div>
                  <div class="form-group col-md-12" id="choice_text_id">
                    <div class="input-group" name="iterm">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-danger" onclick="checkRight(this)">A</button>
                      </div>
                      <script id="editorA" type="text/plain" style="width:100%;height:20px;"></script>
                      <!-- <input type="text" class="form-control" name="choice_text"> -->
                      <span class="input-group-addon" onclick="delChoice(this)">
                        <i class="fa fa-close"></i>
                      </span>
                    </div>
                    <br/>
                    <div class="input-group" name="iterm">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-danger" onclick="checkRight(this)">B</button>
                      </div>
                      <script id="editorB" type="text/plain" style="width:100%;height:20px;"></script>
                      <!-- <input type="text" class="form-control" name="choice_text"> -->
                      <span class="input-group-addon" onclick="delChoice(this)">
                        <i class="fa fa-close"></i>
                      </span>
                    </div>
                    <br/>
                    <div class="input-group" name="iterm">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-danger" onclick="checkRight(this)">C</button>
                      </div>
                      <script id="editorC" type="text/plain" style="width:100%;height:20px;"></script>
                      <!-- <input type="text" class="form-control" name="choice_text"> -->
                      <span class="input-group-addon" onclick="delChoice(this)">
                        <i class="fa fa-close"></i>
                      </span>
                    </div>
                    <br/>
                    <div class="input-group" name="iterm">
                      <div class="input-group-btn">
                        <button type="button" class="btn btn-danger" onclick="checkRight(this)">D</button>
                      </div>
                      <script id="editorD" type="text/plain" style="width:100%;height:20px;"></script>
                      <!-- <input type="text" class="form-control" name="choice_text"> -->
                      <span class="input-group-addon" onclick="delChoice(this)">
                        <i class="fa fa-close"></i>
                      </span>
                    </div>
                  </div>
                  <div class="form-group" id="choice_pic_id" style="display:none;">
                    <div class="col-md-3">
                      <label>
                        选项图片上传
                      </label>
                      <input type="file" name="fileChoice" onchange="checkChoiceImage();">
                    </div>
                    <div class="col-md-9" id="choiceIterm">
                    </div>
                  </div>
                  <div class="form-group col-md-12" id="jiexiForm">
                    <label for="jiexi">解析</label>
                    <script id="editorJiexi" type="text/plain" style="width:100%;height:20px;"></script>
                    <!-- <input type="input" class="form-control" id="jiexi" placeholder="非必填"> -->
                  </div>
                  <div class="form-group has-error col-md-12" style="display:none;" id="errMsg">
                    <label class="control-label"></label>
                  </div>
                </div>
                <!-- /.box-body -->

                <div class="box-footer">
                  <button type="button" class="btn btn-primary" id="tijiao">提交</button>
                  <input type="reset" style="display:none" />
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal fade" tabindex="-1" id="mymodal" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-sm">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">
                  <i class="fa fa-exclamation-circle"></i>
                  <span id="mtitle">[Title]</span>
                </h4>
              </div>
              <div class="modal-body">
                <p id="msg">[Message]</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary ok" data-dismiss="modal" id="BtnOk">[BtnOk]</button>
                <button type="button" class="btn btn-default cancel" data-dismiss="modal" id="BtnCancel">[BtnCancel]</button>
              </div>
            </div>
            <!-- /.modal-content -->
          </div>
          <!-- /.modal-dialog -->
        </div>
      </section>
    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- ./wrapper -->
  <!-- jQuery 3 -->
  <script src="__PUBLIC__/dist/js/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="__PUBLIC__/dist/js/jquery-ui/jquery-ui.min.js"></script>
  <script src="__PUBLIC__/dist/js/jquery.form.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="__PUBLIC__/dist/js/bootstrap.min.js"></script>
  <!-- iCheck 1.0.1 -->
  <script src="__PUBLIC__/dist/js/iCheck/icheck.min.js"></script>
  <!-- AdminLTE App -->
  <script src="__PUBLIC__/dist/js/adminlte.min.js"></script>
  <!-- PACE -->
  <script src="__PUBLIC__/dist/js/pace/pace.min.js"></script>
  <script src="__PUBLIC__/dist/js/webupload/webuploader.min.js"></script>
  <script src="__PUBLIC__/common.js"></script>
  <script src="__PUBLIC__/mydialog.js"></script>
  <script src="__PUBLIC__/dist/ue/ueditor.config.js"></script>
  <script src="__PUBLIC__/dist/ue/ueditor.all.js"></script>
  <script>
    $.ajaxSetup({
      async: false
    }); //异步很重要
    var arr = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K'];
    var type = GetQueryString('type');
    var id = GetQueryString('id');
    var genreid = GetQueryString('genreid');
    var questiontype = GetQueryString('questiontype');
    var ue;
    var ueA;
    var ueB;
    var ueC;
    var ueD;
    var ueJiexi;

    $(document).ajaxStart(function () {
      Pace.restart()
    })

    $(function () {
      ue = UE.getEditor('editor', {
        toolbars: [
          ['fullscreen', 'simpleupload', 'attachment', '|',
            'bold', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript',
            'pasteplain', '|', 'forecolor', 'backcolor', '|',
            'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|',
            'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
            'horizontal', 'spechars'
          ]
        ],
        initialFrameHeight: 100,
      }); //ueditor插件

      if (type == 'add') {
        ueA = UE.getEditor('editorA', {
          toolbars: [
            []
          ],
          wordCount: false,
          elementPathEnabled: false,
          initialFrameHeight: 100
        }); //ueditor插件
        ueA.ready(function () {
          ueA.setHeight(35);
        })
        ueB = UE.getEditor('editorB', {
          toolbars: [
            []
          ],
          wordCount: false,
          elementPathEnabled: false,
          initialFrameHeight: 100
        }); //ueditor插件
        ueB.ready(function () {
          ueB.setHeight(35);
        })

        ueC = UE.getEditor('editorC', {
          toolbars: [
            []
          ],
          wordCount: false,
          elementPathEnabled: false,
          initialFrameHeight: 100
        }); //ueditor插件
        ueC.ready(function () {
          ueC.setHeight(35);
        })

        ueD = UE.getEditor('editorD', {
          toolbars: [
            []
          ],
          wordCount: false,
          elementPathEnabled: false,
          initialFrameHeight: 100
        }); //ueditor插件
        ueD.ready(function () {
          ueD.setHeight(35);
        })
      }

      ueJiexi = UE.getEditor('editorJiexi', {
        toolbars: [
          ['simpleupload']
        ],
        wordCount: false,
        elementPathEnabled: false,
        initialFrameHeight: 100
      }); //ueditor插件
      ueJiexi.ready(function () {
        ueJiexi.setHeight(35);
      })

      getUser();
      if (type == 'add') {
        var html = '添加试题';
      } else {
        var html = '编辑试题';
      }
      $('small').html(html);
      $('.breadcrumb .active').html(html);
      $('.box-title').html(html);

      getQuestionType();
      if (type == 'edit') {
        getQuestionInfo();
      }


      var uploader = WebUploader.create({

        // 选完文件后，是否自动上传。
        auto: true,

        // swf文件路径
        swf: '/js/Uploader.swf',

        // 文件接收服务端。
        server: '../index/uploadExcel',

        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: '#filePicker',

        // 只允许选择图片文件。
        accept: {
          title: 'excel',
          extensions: 'xlsx',
          mimeTypes: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
        }
      });

      uploader.on('uploadSuccess', function (file, response) {
        var info;
        $.ajax({
          type: 'get',
          url: '../Index/importExcelData',
          data: {
            filepath: response.msg,
            genreid: genreid
          },
          // dataType: 'json',
          success: function (res) {
            var options = {
              id: 'mymodal',
              msg: res
            }
            Modal(options).alert();
          }
        })
        // console.log(file);
        // $('#' + file.id).addClass('upload-state-done');
      });

      // 文件上传失败，显示上传出错。
      uploader.on('uploadError', function (file) {
        var $li = $('#' + file.id),
          $error = $li.find('div.error');

        // 避免重复创建
        if (!$error.length) {
          $error = $('<div class="error"></div>').appendTo($li);
        }

        $error.text('上传失败');
      });

    })

    function checkInput() {
      var jiexi = $("#jiexi").val();
      if (jiexi == '') {
        $('#jiexiForm').addClass('has-error');
        $('#jiexiForm').children('span').show();
        $('#errMsg').children().html('解析不能为空！');
        $('#errMsg').show();
        return false;
      } else {
        $('#jiexiForm').removeClass('has-error');
        $('#jiexiForm').children('span').hide();
        $('#errMsg').hide();
        return true;
      }
    }
    $("#jiexi").keyup(function () {
      // checkInput();
    });
    $("#jiexi").blur(function () {
      // checkInput();
    });
    $('#tijiao').click(function () {
      var questionType = $('input[name="r3"]:checked').val(); //题目类型
      var quesgenre = genreid;
      // var questionName = $("#questionName").val(); //题干
      var questionName = ue.getContent();
      var answerflag = $('input[name="r4"]:checked').val(); //多选or单选
      // var contentName = $('#contentName').val(); //文字内容类型
      // var contentPic = $('#contentPic').attr('src'); //文字图片base64编码
      var choiceType = $('input[name="r5"]:checked').val(); //答案类型
      var answerArr = [];
      var choiceArr = [];
      // var jiexi = $('#jiexi').val();
      var jiexi = ueJiexi.getContent();

      if (quesgenre == null) {
        var options = {
          id: 'mymodal',
          msg: '分类不能为空！'
        }
        Modal(options).alert();
        return false;
      }

      if (questionName == '') {
        var options = {
          id: 'mymodal',
          msg: '题干不能为空！'
        }
        Modal(options).alert();
        return false;
      }

      // if (contentType == 2) {
      //   //图片
      //   if (contentPic.length == 0) {
      //     var options = {
      //       id: 'mymodal',
      //       msg: '内容图片不能为空！'
      //     }
      //     Modal(options).alert();
      //   }
      // }

      if (choiceType == 1) {
        //文字
        // $.each($('input[name="choice_text"]'), function (k, v) {
        //   if ($(v).val() != '') {
        //     var obj = {};
        //     obj.flag = arr[k];
        //     obj.content = $(v).val();
        //     choiceArr.push(obj);
        //   }
        // });

        var len = $('#choice_text_id').children('div').length;

        var tmparr = [];
        for (var i = 0; i < len; i++) {
          if (i == 0) {
            var str = ueA.getContent();
          } else if (i == 1) {
            var str = ueB.getContent();
          } else if (i == 2) {
            var str = ueC.getContent();
          } else if (i == 3) {
            var str = ueD.getContent();
          }
          console.log(str);
          if (str == '') {
            continue;
          }
          tmparr.push(str);
        }
        console.log(tmparr);
        for (var i = 0; i < tmparr.length; i++) {
          var obj = {};
          obj.flag = arr[i];
          obj.content = tmparr[i];
          choiceArr.push(obj);
        }
        console.log(choiceArr);

        if (choiceArr.length == 0) {
          var options = {
            id: 'mymodal',
            msg: '答案选项不能为空！'
          }
          Modal(options).alert();
          return false;
        }
        $.each($('#choice_text_id button.btn-success'), function (k, v) {
          answerArr.push($(v).html());
        });
      } else {
        //图片
        $.each($('img[name="iterm"]'), function (k, v) {
          var obj = {};
          obj.flag = arr[k];
          obj.content = $(v).prop('src');
          choiceArr.push(obj);
        });

        if (choiceArr.length == 0) {
          var options = {
            id: 'mymodal',
            msg: '答案选项不能为空！'
          }
          Modal(options).alert();
          return false;
        }
        $.each($('#choice_pic_id button.btn-success'), function (k, v) {
          answerArr.push($(v).html());
        });
      }

      if (answerArr.length < 1) {
        var options = {
          id: 'mymodal',
          msg: '正确答案不能为空！'
        }
        Modal(options).alert();
        return false;
      }
      // if (jiexi == '') {
      //   var options = {
      //     id: 'mymodal',
      //     msg: '解析不能为空！'
      //   }
      //   Modal(options).alert();
      //   return false;
      // }
      $.ajax({
        url: '../Index/addquestiondataBase',
        type: 'post',
        data: {
          type: type,
          id: id,
          quesgenre: quesgenre,
          questionType: questionType,
          questionName: questionName,
          // contentType: contentType,
          answerflag: answerflag,
          // contentName: contentName,
          // contentPic: contentPic,
          choiceType: choiceType,
          answerArr: JSON.stringify(answerArr),
          choiceArr: JSON.stringify(choiceArr),
          jiexi: jiexi,
          ran: Math.random()
        },
        dataType: 'json',
        success: function (data) {
          if (data.errcode == 0) {
            if (type == 'add') {
              // document.getElementById("form").reset();
              // $('#contentPic').prop('src', '');
              // $('#choiceIterm').empty();
              // window.location.href = 'questionlist';
            } else {
              // window.location.href = 'questionlist';
            }
            // window.location.href = 'questionlist?questionGenre=' + questionGenre + '&quesType=1';
            // var grade = $('#grade').val();
            // var term = $('#term').val();
            // var genre = $('#questionGenre').val();
            // var url = 'questionlist_base?grade=' + grade + '&term=' + term + '&genre=' + genre +
            //   '&quesType=1';
            // goRedirect(url);
            window.location.href = 'questionlist_base_frame?quesType=' + questionType + '&genreid=' + genreid;
          } else {
            var options = {
              id: 'mymodal',
              msg: '题目不能重复！'
            }
            Modal(options).alert();
            return false;
          }

        },
        error: function (e) {
          console.log(e);
        }
      })

    })
    //上传图片
    function checkImage() {
      var options = {
        url: '../Index/uploadimg?ran=' + Math.random(), //后台的处理，也就是form里的action
        type: "POST",
        dataType: "json", //数据格式，有XML，html，json，默认为文本
        beforeSubmit: function () {
          // 上传中
        },
        success: function (msg) {
          if (msg.issuc) {
            $('#contentPic').prop('src', msg.msg);
          } else {
            var options = {
              id: 'mymodal',
              msg: '上传失败'
            }
            Modal(options).alert();
          }
        }
      };
      $("#form").ajaxSubmit(options);
      return false; //为了防止刷新
    }
    //上传选项图片
    function checkChoiceImage() {
      var options = {
        url: '../Index/uploadChoiceimg?ran=' + Math.random(), //后台的处理，也就是form里的action
        type: "POST",
        dataType: "json", //数据格式，有XML，html，json，默认为文本
        beforeSubmit: function () {
          // 上传中
        },
        success: function (msg) {
          if (msg.issuc) {
            var total = $('#choiceIterm img').length;
            var html = '<span><button type="button" class="btn btn-danger" onclick="checkRight(this)">' + arr[total] +
              '</button><img src="' + msg.msg +
              '" class="img-rounded" width="110" height="70" name="iterm"><i class="fa fa-close" onclick="delpic(this)"></i>&nbsp;</span>';
            $('#choiceIterm').append(html);
          } else {
            var options = {
              id: 'mymodal',
              msg: '上传失败'
            }
            Modal(options).alert();
          }
        }
      };
      $("#form").ajaxSubmit(options);
      return false; //为了防止刷新
    }

    //删除图片选项
    function delpic(obj) {
      $(obj).parent().remove();
      $('#choiceIterm button').each(function (k, v) {
        $(v).html(arr[k]);
      })
    }

    //删除文字选项
    function delChoice(obj) {
      $(obj).parent().next('br').remove();
      $(obj).parent().remove();
      $('#choice_text_id button').each(function (k, v) {
        $(v).html(arr[k]);
      })
    }

    function checkRight(obj) {
      var answerflag = $('input[name="r4"]:checked').val(); //单选OR多选
      var choiceType = $('input[name="r5"]:checked').val(); //答案类型
      if (answerflag == 1) {
        //单选
        if (choiceType == 1) {
          //文字
          $('#choice_text_id').find('button').removeClass('btn-success').addClass('btn-danger');
          $('#choice_text_id').children('div').removeClass('has-success');
        } else {
          //图片
          $('#choice_pic_id').find('button').removeClass('btn-success').addClass('btn-danger');
        }
        $(obj).removeClass('btn-danger').addClass('btn-success');
        $(obj).parent().parent().addClass('has-success');
      } else {
        if ($(obj).hasClass('btn-danger')) {
          $(obj).removeClass('btn-danger').addClass('btn-success');
          $(obj).parent().parent().addClass('has-success');
        } else {
          $(obj).removeClass('btn-success').addClass('btn-danger');
          $(obj).parent().parent().removeClass('has-success');
        }
      }
    }

    //新增选项
    function addChoice() {
      var index = $('#choiceIterm img').length;
      var arr = ['A', 'B', 'C'];
      index = 1;
      alert(arr[index]);
    }
    //获取试题类型
    function getQuestionType() {
      $.ajax({
        url: '../Index/getQuestionType',
        type: 'get',
        data: {
          ran: Math.random()
        },
        dataType: 'json',
        success: function (data) {
          var html = '';
          $.each(data, function (k, v) {
            var ischecked = '';
            k == (questiontype - 1) ? ischecked = 'checked' : ischecked = '';
            html += '<label>';
            html += '<input type="radio" name="r3" class="flat-red" value="' + v.id + '" ' + ischecked + '>' +
              v.name;
            html += '</label>'
          })
          $('#questionType').html(html);
          //Flat red color scheme for iCheck
          $('#questionType input[type="radio"].flat-red').iCheck({
            checkboxClass: 'icheckbox_flat-green',
            radioClass: 'iradio_flat-green'
          }).on('ifChecked', function (event) {
            if ($(this).val() == 1) {
              var url = 'addquestion_frame_new?genreid=' + genreid + '&type=add&id=0&questiontype=1';
            } else {
              var url = 'addquestioninput_frame_new?genreid=' + genreid + '&type=add&id=0&questiontype=2';
            }
            window.location.href = url;
          });
        },
        error: function (e) {
          console.log(e);
        }
      })
    }
    //获取试题分类
    function setGenre() {
      var grade = $('#grade').val();
      var term = $('#term').val();
      $.ajax({
        url: '../Index/getAllGenreBase',
        type: 'get',
        data: {
          grade: grade,
          term: term,
          ran: Math.random()
        },
        dataType: 'json',
        success: function (data) {
          $('#questionGenre').empty();
          $.each(data, function (k, v) {
            $('#questionGenre').append($('<option>').html(v.name).val(v.id));
          });
        },
        error: function (e) {
          console.log(e);
        }
      })
    }


    //单选OR多选
    $('#answerflag input[type="radio"].flat-red').iCheck({
      checkboxClass: 'icheckbox_flat-green',
      radioClass: 'iradio_flat-green'
    }).on('ifChecked', function (event) {});
    //选项内容选择
    $('#choice_id input[type="radio"].flat-red').iCheck({
      checkboxClass: 'icheckbox_flat-green',
      radioClass: 'iradio_flat-green'
    }).on('ifChecked', function (event) {
      if ($(this).val() == 1) {
        //文字
        $('#choice_text_id').show();
        $('#choice_pic_id').hide();
      } else {
        //图片
        $('#choice_text_id').hide();
        $('#choice_pic_id').show();
      }
    });

    function getQuestionInfo() {
      $.ajax({
        url: '../Index/getQuestionInfoBase',
        type: 'get',
        data: {
          id: id,
          ran: Math.random()
        },
        dataType: 'json',
        success: function (data) {
          var ques = eval('(' + data.content + ')');
          $('input[name=r3]').each(function () {
            if (this.value == ques.quesType) {
              $(this).iCheck('check');
            }
          });
          $('input[name=r4]').each(function () {
            if (this.value == ques.answerFlag) {
              $(this).iCheck('check');
            }
          });
          $('input[name=r5]').each(function () {
            if (this.value == ques.quesChoiceType) {
              $(this).iCheck('check');
            }
          });
          $('#editor').html(ques.quesName);
          $('#editorJiexi').html(ques.jiexi);
          // $('#questionName').val(ques.quesName);
          // if (ques.quesContentType == 1) {
          //   //文字
          //   $('#contentName').val(ques.quesContent);
          // } else {
          //   //图片
          //   $('#contentPic').attr('src', ques.quesContent);
          // }
          if (ques.quesChoiceType == 1) {
            //文字
            var html = '';
            $.each(ques.quesChoice, function (k, v) {
              if ($.inArray(v.flag, ques.answer) != -1) {
                html += '<div class="input-group has-success" name="iterm">';
              } else {
                html += '<div class="input-group" name="iterm">';
              }
              html += '<div class="input-group-btn">'
              if ($.inArray(v.flag, ques.answer) != -1) {
                html += '<button type="button" class="btn btn-success" onclick="checkRight(this)">' + arr[k] +
                  '</button>';
              } else {
                html += '<button type="button" class="btn btn-danger" onclick="checkRight(this)">' + arr[k] +
                  '</button>';
              }
              html += '</div>';
              html += '<script id="editor' + arr[k] + '" type="text/plain" style="width:100%;height:20px;">' +
                v.content + '</scrip' + 't>';
              // html += '<input type="text" class="form-control" name="choice_text" value="' + v.content + '">';
              html += '<span class="input-group-addon" onclick="delChoice(this)">';
              html += '<i class="fa fa-close"></i>'
              html += '</span>';
              html += '</div>';
              html += '<br/>';
              // $('input[name="choice_text"]').eq(k).parent().prev('div').children('button').html(v.flag);
              // $('input[name="choice_text"]').eq(k).val(v.content);
              // if (v.flag == ques.answer) {
              //   $('#choice_text_id button').eq(k).removeClass('btn-danger').addClass('btn-success');
              //   $('#choice_text_id').children('div').eq(k).addClass('has-success');
              // }
            });
            $('#choice_text_id').html(html);
          } else {
            //图片
            $.each(ques.quesChoice, function (k, v) {
              if ($.inArray(v.flag, ques.answer) != -1) {
                var bclass = 'btn-success';
              } else {
                var bclass = 'btn-danger';
              }
              var html = '<span><button type="button" class="btn ' + bclass + '" onclick="checkRight(this)">' +
                v.flag + '</button><img src="' + v.content +
                '" class="img-rounded" width="110" height="70" name="iterm"><i class="fa fa-close" onclick="delpic(this)"></i>&nbsp;</span>';
              $('#choiceIterm').append(html);
            });
          }
          if ($('#editorA').length) {
            ueA = UE.getEditor('editorA', {
              toolbars: [
                []
              ],
              wordCount: false,
              elementPathEnabled: false,
              initialFrameHeight: 100
            }); //ueditor插件
            ueA.ready(function () {
              ueA.setHeight(35);
            })
          }
          if ($('#editorB').length) {
            ueB = UE.getEditor('editorB', {
              toolbars: [
                []
              ],
              wordCount: false,
              elementPathEnabled: false,
              initialFrameHeight: 100
            }); //ueditor插件
            ueB.ready(function () {
              ueB.setHeight(35);
            })
          }
          if ($('#editorC').length) {
            ueC = UE.getEditor('editorC', {
              toolbars: [
                []
              ],
              wordCount: false,
              elementPathEnabled: false,
              initialFrameHeight: 100
            }); //ueditor插件
            ueC.ready(function () {
              ueC.setHeight(35);
            })
          }
          if ($('#editorD').length) {
            ueD = UE.getEditor('editorD', {
              toolbars: [
                []
              ],
              wordCount: false,
              elementPathEnabled: false,
              initialFrameHeight: 100
            }); //ueditor插件
            ueD.ready(function () {
              ueD.setHeight(35);
            })
          }
        },
        error: function (e) {
          console.log(e);
        }
      })
    }


    $('#daochu').click(function () {
      location.href = "../Index/downloadExcel";
    })
    $('#daoru').click(function () {
      var options = {
        id: 'mymodal',
        msg: '确定导入到当前分类么?',
        // btnok: '确定',
        // btncl: '回到试题列表'
      }
      Modal(options).confirm().on(function (e) {
        if (e) {
          //确定按钮
          var questionGenre = $('#questionGenre').val();
          var url = 'import.html?questionGenre=' + questionGenre;

        } else {
          //取消按钮
        }
      });
    })
  </script>
</body>

</html>